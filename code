import pandas as pd
import numpy as np
import re
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity
from nltk.corpus import stopwords
import nltk
nltk.download('stopwords')

resumes = pd.read_csv("resumes.csv") 
with open("job_description.txt", "r") as f:
    jd_text = f.read() 

def preprocess(text):
    text = text.lower()  # lowercase
    text = re.sub(r'[^a-z\s]', '', text)  # remove numbers/punctuation
    stop_words = set(stopwords.words('english'))
    text = " ".join([w for w in text.split() if w not in stop_words])  # remove stopwords
    return text

# Apply preprocessing
resumes["clean_text"] = resumes["text"].apply(preprocess)  # preprocess resume text
clean_jd = preprocess(jd_text)  # preprocess JD

# TF-IDF Vectorization

documents = [clean_jd] + resumes["clean_text"].tolist()

vectorizer = TfidfVectorizer()
tfidf_matrix = vectorizer.fit_transform(documents)

# Compute cosine similarity
cos_sim = cosine_similarity(tfidf_matrix[0:1], tfidf_matrix[1:])  # JD vs resumes
cos_sim = cos_sim.flatten()  # flatten 2D array to 1D


# Add match score to DataFrame and rank

resumes["match_score"] = cos_sim
ranked_resumes = resumes.sort_values(by="match_score", ascending=False)  # highest first
ranked_resumes.reset_index(drop=True, inplace=True)

top = 5
print(ranked_resumes[["name", "match_score"]].head(top))  
      
